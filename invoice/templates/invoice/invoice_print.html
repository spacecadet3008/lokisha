<!-- templates/invoice/invoice_print.html -->
<!DOCTYPE html>
<html lang="en">
{% load humanize %}
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>{% if invoice.is_proforma %}Proforma{% else %}Invoice{% endif %} #{{ invoice.invoice_number }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @media print {
            body {
                margin: 0;
                padding: 15px;
                font-size: 12px;
            }
            .no-print {
                display: none !important;
            }
            .invoice-print-container {
                border: none !important;
                box-shadow: none !important;
            }
            .table {
                font-size: 11px;
            }
            .badge {
                font-size: 10px;
                padding: 4px 8px;
            }
        }
        body {
            background: white !important;
            font-family: Arial, sans-serif;
        }
        .invoice-print-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .company-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #28a745;
        }
        .company-logo {
            width: 100px;
            height: 100px;
            margin-right: 20px;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 5px;
            background: white;
        }
        .company-details {
            flex: 1;
        }
        .payment-method {
            background-color: #f8f9fa;
            border-left: 2px solid #28a745;
            padding: 08px;
        }
    </style>
</head>
<body>
<div class="invoice-print-container">
    <!-- Header with Logo and Company Details -->
    <div class="company-header">
        <img src="{% static 'images/logo/lokisha_1.png' %}" alt="Lokisha Enterprise" class="company-logo">
        <div class="company-details">
            <h2 class="text-success mb-1">LOKISHA GENERAL SUPPLIES</h2>
            <p class="mb-1">Best Quality Better Price</p>
            <p class="mb-1">P.O. Box 295, Arusha, Tanzania</p>
            <p class="mb-1">Phone: +255 123 456 789</p>
            <p class="mb-0">Email: info@lokisha.co.tz</p>
        </div>
        
        <!-- Invoice Info on the right -->
        <div class="text-end">
            <h5 class="mb-2">
                <span class="badge {% if invoice.is_proforma %}bg-info{% else %}bg-success{% endif %}">
                    {% if invoice.is_proforma %}PROFORMA INVOICE{% else %}INVOICE{% endif %}
                </span>
            </h5>
            <p class="mb-1"><strong>{% if invoice.is_proforma %}Proforma{% else %}Invoice{% endif %} #:</strong> {{ invoice.invoice_number }}</p>
            <p class="mb-1"><strong>Date:</strong> {{ invoice.date|date:"M d, Y" }}</p>
            <p class="mb-1"><strong>Due Date:</strong> {{ invoice.due_date|date:"M d, Y" }}</p>
            <p class="mb-0">
                <strong>Status:</strong> 
                <span class="badge 
                    {% if invoice.status == 'draft' %}bg-secondary
                    {% elif invoice.status == 'sent' %}bg-info
                    {% elif invoice.status == 'paid' %}bg-success
                    {% else %}bg-danger{% endif %}">
                    {{ invoice.status|title }}
                </span>
            </p>
        </div>
    </div>

    <!-- Invoice Details -->
    <div class="row">

        <!-- Customer Information -->
        <div class="col-md-6">
            <div class="card border-0 mb-4">
                <div class="card-body p-3 bg-light">
                    <h6 class="card-title border-bottom pb-2">Bill To</h6>
                    <p class="mb-1"><strong>{{ invoice.customer_name.first_name }} {{ invoice.customer_name.last_name }}</strong></p>
                    <p class="mb-1">Phone: {{ invoice.contact_number }}</p>
                    {% if invoice.customer_name.email %}
                    <p class="mb-1">Email: {{ invoice.customer_name.email }}</p>
                    {% endif %}
                    {% if invoice.customer_name.address %}
                    <p class="mb-0">Address: {{ invoice.customer_name.address }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Items Table -->
    <div class="card border-0 mb-4">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-success">
                        <tr>
                            <th style="width: 300px;">Item</th>
                            <th class="text-center">Quantity</th>
                            <th class="text-end">Unit Price (Tsh)</th>
                            <th class="text-end">Total (Tsh)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in invoice.items.all %}
                        <tr>
                            <td>{{ item.item.name }}</td>
                            <td class="text-center">{{ item.quantity|intcomma:2 }}</td>
                            <td class="text-end">{{ item.price_per_item|intcomma:2 }}</td>
                            <td class="text-end">{{ item.total_price|intcomma:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <td colspan="3" class="text-end fw-bold">Subtotal:</td>
                            <td class="text-end fw-bold">Tsh {{ invoice.total|intcomma:2 }}</td>
                        </tr>
                        {% if invoice.tax_amount > 0 %}
                        <tr>
                            <td colspan="3" class="text-end fw-bold">Tax ({{ invoice.tax_percentage }}%):</td>
                            <td class="text-end fw-bold">Tsh {{ invoice.tax_amount|intcomma:2 }}</td>
                        </tr>
                        {% endif %}
                        {% if invoice.discount > 0 %}
                        <tr>
                            <td colspan="3" class="text-end fw-bold">Discount:</td>
                            <td class="text-end fw-bold">-Tsh {{ invoice.discount|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                        {% if invoice.shipping > 0 %}
                        <tr>
                            <td colspan="3" class="text-end fw-bold">Shipping:</td>
                            <td class="text-end fw-bold">Tsh {{ invoice.shipping|intcomma:2 }}</td>
                        </tr>
                        {% endif %}
                        <tr class="table-active">
                            <td colspan="3" class="text-end fw-bold ">Grand Total:</td>
                            <td class="text-end fw-bold  text-success">Tsh {{ invoice.grand_total|intcomma:2 }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Payment Method Section - Side by Side -->
    <div class="payment-method">
        <h6 class="mb-3"><i class="fas fa-credit-card me-2"></i>Payment Methods</h6>
        <div class="row">
            <div class="col-md-6">
                <p class="mb-2"><strong>Payment Methods:</strong></p>
                <p class="mb-1">CRDB Bank : Lokisha Company Limited </p>
                <p class="mb-1">Account Number: 0152356789001</p>
                <p class="mb-0">SWIFT Code: CORUTZTZ</p>
            </div>
        </div>
        </div>
        <!--<div class="row mt-3">
            <div class="col-12">
                <p class="mb-1"><strong>Payment Terms:</strong></p>
                <p class="mb-0">Payment due within {{ invoice.terms_days }} days of invoice date</p>
            </div>
        </div>
    </div> -->

    <!-- Notes -->
    {% if invoice.notes %}
    <div class="card border-0 mt-4">
        <div class="card-body p-3 bg-light">
            <h6 class="card-title border-bottom pb-2">Notes</h6>
            <p class="mb-0">{{ invoice.notes|linebreaks }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Footer -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <p class="text-muted mb-0">
                <i class="fas fa-phone me-1"></i> +255 123 456 789 | 
                <i class="fas fa-envelope ms-2 me-1"></i> info@lokisha.co.tz |
                <i class="fas fa-globe ms-2 me-1"></i> www.lokisha.co.tz
            </p>
            <p class="text-muted small mt-1">
                Thank you for your business! â€¢ Terms: Payment due within {{ invoice.terms_days }} days
            </p>
        </div>
    </div>
</div>

<script>
    // Auto-print when page loads
    window.onload = function() {
        window.print();
        
        // Close window after printing (optional)
        setTimeout(function() {
            window.close();
        }, 500);
    }
    
    // Allow manual printing with Ctrl+P
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'p') {
            e.preventDefault();
            window.print();
        }
    });
</script>
</body>
</html>